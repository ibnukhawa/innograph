<?xml version="1.0"?>
<odoo>
    <data>
        <template id="sale.report_saleorder">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="doc">
                    <div class="header">
                        <div class="row">
                            <div class="col-xs-8">
                                <img class="image" t-att-src="'data:image/png;base64,%s' % res_company.logo" style="height:80px;display:block;float:left;padding-right:10px;"/>
                                <div t-if="doc.state in ['sale', 'done']" style="height:80px;display:block;float:left;font-size:11px;width:350px;">
                                    <h5><b t-esc="res_company.name"/></h5>
                                    <t t-esc="res_company.partner_id.street"/><br/>
                                    <t t-esc="res_company.partner_id.street2"/>
                                    <t t-esc="res_company.partner_id.city"/>
                                    <t t-esc="res_company.partner_id.state_id.name"/>
                                    <t t-esc="res_company.partner_id.zip"/><br/>
                                    <b>PHONE: <t t-esc="res_company.phone"/></b><br/>
                                    <b>FAX: <t t-esc="res_company.fax"/></b>
                                </div>
                            </div>
                            <div t-if="doc.state in ['sale', 'done']" class="col-xs-4">
                                <div style="font-size:26px;margin:-6px 1px -12px 0px;letter-spacing:0px;"><b>SALES ORDER / CONTRACT</b></div>
                            </div>
                        </div>
                    </div>
                    <t t-set="doc" t-value="doc.with_context({'lang':doc.partner_id.lang})" />
                    <div class="page">
                        <div class="oe_structure"/>
                        <div class="row">
                            <t t-set="contact" t-value="doc._get_contact_person()" />
                            <!-- IF State in Draft -->
                            <t t-if="doc.state in ['draft', 'sent']">
                                <h3 class="text-center">PENAWARAN HARGA</h3>
                                <table style="width:100%">
                                    <tr>
                                        <td style="width:23%;">To</td>
                                        <td style="width:4%;">:</td>
                                        <td style="width:23%;"><span t-esc="contact.name" /></td>
                                        <td style="width:23%;">Sales Name</td>
                                        <td style="width:4%;">:</td>
                                        <td style="width:23%;"><span t-esc="doc.user_id.name" /></td>
                                    </tr>
                                    <tr>
                                        <td>Company</td>
                                        <td>:</td>
                                        <td><span t-esc="doc.partner_id.name" /></td>
                                        <td>Contract/SO Date</td>
                                        <td>:</td>
                                        <td><span t-field="doc.date_order" t-field-options="{'format': 'dd-MM-yyyy'}" /></td>
                                    </tr>
                                    <tr>
                                        <td>Phone</td>
                                        <td>:</td>
                                        <td><span t-esc="doc.partner_id.phone" /></td>
                                        <td>No. Quotation</td>
                                        <td>:</td>
                                        <td><span t-esc="doc.name" /></td>
                                    </tr>
                                    <tr>
                                        <td>Fax</td>
                                        <td>:</td>
                                        <td><span t-esc="doc.partner_id.fax" /></td>
                                        <td>Quotation Date</td>
                                        <td>:</td>
                                        <td><span t-field="doc.date_order" t-field-options="{'format': 'dd-MM-yyyy'}" /></td>
                                    </tr>
                                </table>
                            </t>

                            <!-- IF STATE IN SALE -->
                            <t t-if="doc.state in ['sale', 'done']">
                                <div class="col-xs-8">
                                    <table class="table table-bordered" style="width:90%;height:50px;">
                                        <tr><td style="padding: 1px;">CUSTOMER</td></tr>
                                        <tr>
                                            <td>
                                                <span t-esc="doc.partner_id.name" /><br/>
                                                <span t-esc="doc.partner_id.street" /><br/>

                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-xs-4">
                                    <table class="table table-bordered" style="margin-bottom:3px;padding:0px;">
                                        <tr>
                                            <td style="width:50%;padding: 1px;"><b>SO DATE:</b></td>
                                            <td style="width:50%;padding: 1px;"><b>NO. SO:</b></td>
                                        </tr>
                                        <tr>
                                            <td style="width:50%;padding: 1px;"><span t-field="doc.date_order" t-field-options="{'format': 'dd-MM-yyyy'}" /></td>
                                            <td style="width:50%;padding: 1px;"><span t-esc="doc.name" /></td>
                                        </tr>
                                    </table>
                                    <table class="table table-bordered" style="margin-bottom:3px;padding:0px;">
                                        <tr>
                                            <td style="width:50%;padding: 1px;"><b>Terms:</b></td>
                                            <td style="width:50%;padding: 1px;"><b>PO Number:</b></td>
                                        </tr>
                                        <tr>
                                            <td style="width:50%;padding: 1px;"><span t-esc="doc.payment_term_id.name" /></td>
                                            <td style="width:50%;padding: 1px;"><!-- <span t-esc="" /> --></td>
                                        </tr>
                                    </table>
                                    <table class="table table-bordered" style="margin-bottom:3px;padding:0px;">
                                        <tr>
                                            <td style="width:50%;padding: 1px;"><b>Ship DATE:</b></td>
                                            <td style="width:50%;padding: 1px;"><b>Ship Via:</b></td>
                                        </tr>
                                        <tr>
                                            <td style="width:50%;padding: 1px;"></td>
                                            <td style="width:50%;padding: 1px;"></td>
                                        </tr>
                                    </table>
                                    <table class="table table-bordered" style="margin-bottom:3px;padding:0px;">
                                        <tr>
                                            <td style="width:50%;padding: 1px;"><b>Salesperson:</b></td>
                                            <td style="width:50%;padding: 1px;"><span t-esc="doc.user_id.name" /></td>
                                        </tr>
                                    </table>
                                </div>
                            </t>

                            <!-- Order Line -->
                            <t t-foreach="doc.order_lines_layouted()" t-as="page">
                                <table class="table table-condensed table-bordered">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <t t-if="doc.state in ['draft', 'sent']">
                                                <th>Part Number</th>
                                                <th>Deskripsi (Unique)</th>
                                                <th class="text-right">Harga/unit (Rp)</th>
                                                <th class="text-right">Qty</th>
                                                <th t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">Disc.(%)</th>
                                                <th class="text-right" groups="sale.group_show_price_subtotal">Harga Total (Rp)</th>
                                            </t>
                                            <t t-if="doc.state in ['sale', 'done']">
                                                <th>Item No.</th>
                                                <th>Item Description</th>
                                                <th>Unit Price</th>
                                                <th>Qty</th>
                                                <th>Tax</th>
                                                <th class="text-right" groups="sale.group_show_price_subtotal">Amount</th>
                                            </t>
                                            <!-- <th class="text-right price_tax_included" groups="sale.group_show_price_total"></th> -->
                                        </tr>
                                   </thead>
                                   <tbody class="sale_tbody">
                                        <t t-foreach="page" t-as="layout_category">

                                            <t t-if="layout_category_size > 1 or page_size > 1" groups="sale.group_sale_layout">
                                                <tr class="active">
                                                    <td colspan="7" style="font-weight: bold; border-bottom: 1px solid black;">&amp;bull;
                                                        <t t-esc="layout_category['name']"/>
                                                    </td>
                                                </tr>
                                            </t>
                                            <t t-set="count" t-value="0" />
                                            <!-- Lines associated -->
                                            <t t-foreach="layout_category['lines']" t-as="l">
                                                <tr t-if="not l.product_id.is_discount">
                                                    <t t-set="count" t-value="count+1" />
                                                    <td style="width:5%;"><span t-esc="count" /></td>
                                                    <td><span t-esc="l.product_id.default_code" /></td>
                                                    <td><span t-field="l.name"/></td>
                                                    <td class="text-right">
                                                        <span t-field="l.price_unit"/>
                                                    </td>
                                                    <td class="text-right">
                                                        <span t-field="l.product_uom_qty"/>
                                                        <span t-field="l.product_uom" groups="product.group_uom"/>
                                                    </td>
                                                    <td t-if="display_discount and doc.state in ['draft', 'sent']" class="text-right" groups="sale.group_discount_per_so_line">
                                                        <span t-field="l.discount"/>
                                                    </td>
                                                    <td t-if="doc.state in ['sale', 'done']" class="text-right">
                                                        <span t-esc="', '.join(map(lambda x: (x.description or x.name), l.tax_id))"/>
                                                    </td>
                                                    <td class="text-right" groups="sale.group_show_price_subtotal">
                                                        <span t-field="l.price_subtotal"
                                                            t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                    </td>
                                                    <!-- <td class="text-right" groups="sale.group_show_price_total">
                                                        <span t-field="l.price_total"
                                                            t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                    </td> -->
                                                </tr>
                                            </t>

                                            <t t-if="(layout_category_size > 1 or page_size > 1) and layout_category['subtotal']" groups="sale.group_sale_layout">
                                                <tr class="text-right">
                                                    <td colspan="6">
                                                        <strong>Subtotal: </strong>
                                                        <t t-set="subtotal" t-value="sum(line.price_subtotal for line in layout_category['lines'])"/>
                                                        <span t-esc="subtotal" t-options="{'widget': 'monetary', 'display_currency': doc.pricelist_id.currency_id}"/>
                                                    </td>
                                                </tr>
                                            </t>

                                        </t>
                                    </tbody>
                                </table>

                                <t t-if="page_index &lt; page_size - 1" groups="sale.group_sale_layout">
                                    <p style="page-break-before:always;"> </p>
                                </t>
                            </t>

                            <div class="row" name="total">
                                <div class="col-xs-8">
                                    <p t-field="doc.note" />
                                </div>
                                <div class="col-xs-4 pull-right">
                                    <table class="table table-condensed table-bordered">
                                        <tr class="border-black">
                                            <td><strong>SubTotal</strong></td>
                                            <td class="text-right">
                                                <span t-field="doc.amount"
                                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                            </td>
                                        </tr>
                                        <tr class="border-black" t-if="doc.state in ['sale', 'done']">
                                            <td><strong>Discount</strong></td>
                                            <td class="text-right">
                                                <span t-field="doc.discount"
                                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                            </td>
                                        </tr>
                                        <t t-foreach="doc._get_tax_amount_by_group()" t-as="amount_by_group">
                                            <tr>
                                                <td><span t-esc="amount_by_group[0] or 'Taxes'"/></td>
                                                <td class="text-right">
                                                    <span t-esc="amount_by_group[1]"
                                                        t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                </td>
                                            </tr>
                                        </t>
                                        <tr class="border-black" t-if="doc.state in ['sale', 'done']">
                                            <td><strong>Estimated Freight</strong></td>
                                            <td class="text-right">
                                                <!-- ???? -->
                                            </td>
                                        </tr>
                                        <tr class="border-black">
                                            <td><strong>Total</strong></td>
                                            <td class="text-right">
                                                <span t-field="doc.amount_total"
                                                    t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="footer">
                        <div class="col-xs-4 text-center" t-if="doc.state in ['draft', 'sent']">
                            <span>Terima kasih,</span><br/>
                            <span t-esc="doc.company_id.name" /><br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            (<span t-esc="doc.user_id.name" />)
                        </div>
                        <div class="col-xs-4 pull-right text-center" t-if="doc.state in ['draft', 'sent']">
                            <span>Menyetujui</span><br/>
                            <span t-esc="doc.partner_id.name" /><br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <span>(.........................)</span>
                        </div>

                        <div class="col-xs-2" t-if="doc.state in ['sale', 'done']" />
                        <div class="col-xs-3" t-if="doc.state in ['sale', 'done']">
                            <span>Prepared by</span><br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <span>(.........................)</span><br/>
                            <span>Date :</span>
                        </div>
                        <div class="col-xs-4 pull-right" t-if="doc.state in ['sale', 'done']">
                            <span>Approved by</span><br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <br/>
                            <span>(.........................)</span><br/>
                            <span>Date :</span>
                        </div>

                        <div class="col-xs-12 text-center">
                            <ul class="list-inline">
                                <li>Page:</li>
                                <li><span class="page"/></li>
                                <li>/</li>
                                <li><span class="topage"/></li>
                            </ul>
                        </div>
                    </div>
                </t>
            </t>
        </template>
    </data>
</odoo>
